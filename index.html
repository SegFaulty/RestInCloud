<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>RestInCloud by SegFaulty</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>RestInCloud</h1>
        <h2>simple restfully dockerized distributed open source cloud backup server ;-)</h2>

        <section id="downloads">
          <a href="https://github.com/SegFaulty/RestInCloud/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/SegFaulty/RestInCloud/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/SegFaulty/RestInCloud" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="restincloud" class="anchor" href="#restincloud" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="http://segfaulty.github.io/RestInCloud/">RestInCloud</a>
</h1>

<p>simple restfully dockerized distributed open source cloud backup server ;-)</p>

<h2>
<a id="install-server" class="anchor" href="#install-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install Server</h2>

<p>to install the ric-server check <a href="deployment/">deployment dir</a> for different enviroments (<a href="deployment/docker">docker</a>, <a href="deployment/apache">apache</a>, <a href="deployment/nginx">nginx</a>)</p>

<h2>
<a id="client-for-cli" class="anchor" href="#client-for-cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>Client for CLI</h2>

<p>if your ric-servers are running, you can use the smart "ric" cli tool to backup etc. and manage the cluster</p>

<p><a href="src/Ric/Client/README.md">Client-README</a></p>

<h2>
<a id="help" class="anchor" href="#help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Help</h2>

<h3>
<a id="api-overview" class="anchor" href="#api-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Api Overview</h3>

<h4>
<a id="show-help" class="anchor" href="#show-help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Show Help</h4>

<pre><code>GET /
GET /?help
</code></pre>

<h4>
<a id="file" class="anchor" href="#file" aria-hidden="true"><span class="octicon octicon-link"></span></a>File:</h4>

<pre><code>PUT  /filename              # backup/upload a file
POST /filename              # refresh file if exists
GET  /filename              # restore/download a file
GET  /filename?check        # check exists, replicas, freshness, size of the file
GET  /filename?list         # list all versions of the file
DELETE /filename            # delete a selected or all version of the file
</code></pre>

<h4>
<a id="server-management" class="anchor" href="#server-management" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server Management</h4>

<pre><code>GET  /?list                 # list all files on this server
GET  /?info                 # show server info
GET  /?health               # show cluster health

POST /?addServer            # add a remote server to server (internal for cluster management)
POST /?removeServer         # remove a server from connected server (internal for cluster management)
POST /?joinCluster          # add the server to existing cluster 
POST /?leaveCluster         # leave a cluster
POST /?removeFromCluster    # drop a other server out of cluster
POST /filename push=&gt;server # push file to server
</code></pre>

<h3>
<a id="api-details" class="anchor" href="#api-details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Api Details</h3>

<ul>
<li>GET <a href="http://ric1.server/?help">http://ric1.server/?help</a> - show this help</li>
<li>GET <a href="http://ric1.server/?list">http://ric1.server/?list</a> - list all files ... &amp;pattern=~regEx~i&amp;limit=100&amp;start=100&amp;showDeleted=1 (ordered by random!)</li>
<li>GET <a href="http://ric1.server/?listDetails">http://ric1.server/?listDetails</a> -  list all files with details - parameters like ?list</li>
<li><p>GET <a href="http://ric1.server/?info">http://ric1.server/?info</a> - show server infos (and quota if set)</p></li>
<li>
<p>PUT <a href="http://ric1.server/error.log">http://ric1.server/error.log</a> - upload a file to the store</p>

<ul>
<li>use ?timestamp=1422653.. to set correct modificationTime [default:requestTime]</li>
<li>use &amp;retention=last3 to select the backup retention strategy [default:last3]</li>
<li>use &amp;noSync to suppress syncronisation to replication servers (used for internal sync)</li>
<li>retention strategies (versions sorted by timestamp):
{retentionList}</li>
<li>with curl:
curl -X PUT --upload /home/www/phperror.log <a href="http://ric1.server/error.log">http://ric1.server/error.log</a>
curl -X PUT --upload "/home/www/phperror.log" "<a href="http://ric1.server/error.log&amp;retention=last7&amp;timestamp=1429628531">http://ric1.server/error.log&amp;retention=last7&amp;timestamp=1429628531</a>"</li>
</ul>
</li>
<li>
<p>POST <a href="http://ric1.server/error.log?sha1=23423ef3d..&amp;timestamp=1422653">http://ric1.server/error.log?sha1=23423ef3d..&amp;timestamp=1422653</a>.. - check and refresh a file</p>

<ul>
<li>checks if version exists and updates timestamp</li>
<li>returns 1 if version was updated, 0 if version not exists</li>
<li>if 1 is returned, there is no need to upload the same version</li>
<li>use &amp;noSync to suppress syncronisation to replication servers (used for internal sync)</li>
<li>if &amp;noSync is not set, refresh is also performed on the replication servers (with &amp;noSync)</li>
</ul>
</li>
<li><p>POST <a href="http://ric1.server/error.log">http://ric1.server/error.log</a>  ?action=delete  - delete a file !! Attention if version is omitted, ALL Versions will be deleted</p></li>
<li>POST <a href="http://ric1.server/error.log">http://ric1.server/error.log</a>  ?action=push&amp;targetServer=ricx.example.com  - push file to other server (with admin pw)</li>
<li><p>DELETE <a href="http://ric1.server/error.log">http://ric1.server/error.log</a>   - delete a file !! Attention if version is omitted, ALL Versions will be deleted</p></li>
<li><p>GET <a href="http://ric1.server/error.log">http://ric1.server/error.log</a> - download a file (etag and lastmodified supported)</p></li>
<li>GET <a href="http://ric1.server/error.log?&amp;version=13445afe23423423">http://ric1.server/error.log?&amp;version=13445afe23423423</a> - version selects a specific version, if omitted the latest version is assumed (must not: ...error.log?version... )</li>
<li>GET <a href="http://ric1.server/error.log?list">http://ric1.server/error.log?list</a> - show all (or &amp;limit) versions for this file; (ordered by latest); &amp;showDeleted=1 to include files marked for deletion</li>
<li>
<p>GET <a href="http://ric1.server/error.log?check&amp;minSize=40000&amp;minReplicas=2&amp;minTimestamp=14234234&amp;sha=1234ef23">http://ric1.server/error.log?check&amp;minSize=40000&amp;minReplicas=2&amp;minTimestamp=14234234&amp;sha=1234ef23</a></p>

<ul>
<li>check that the file</li>
<li>(1) exists,</li>
<li>(2) size &gt;40k [default:1],</li>
<li>(3) fileTime&gt;=minTimestamp [default:8d],</li>
<li>(4) min 2 replicas (3 files) [default:max(1,count(servers)-1)]</li>
<li>(5) sha1, (if sha give, the size is irrelevant)</li>
<li>returns json result with status: OK/WARNING/CRITICAL, a msg and fileInfo</li>
</ul>

<p>admin Commands:
Post: with parameters: [action: addServer, addServer: s1.cs.io:3723]</p>
</li>
<li>addServer s1.cs.io:3723 - add Server to local list,</li>
<li>removeServer s1.cs.io:3723 - remove Server from local list</li>
<li>removeServer all - remove all Servers from local list</li>
<li>joinCluster s2.cs.io - join to existing cluster (or join a single node and create a cluster)</li>
<li>leaveCluster - leave a cluster (send removeServer=self to all cluster nodes an clear my servers list)</li>
<li>
<p>removeFromCluster s3.cs.io - kick a server from the servers list of all known nodes (use this if the server is unresponsive and you can't send a leaveCluster)</p>

<p>auth (only as parameter supported yet)</p>
</li>
<li>
<p>use &amp;token=YourAdminToken to authenticate as admin or writer or reader (e.g. for info command)</p>

<p>serverVersion</p>
</li>
<li>use &amp;minServerVersion=1.4.0 to require a minimal ServerVersion - it also acts reverse - if the client major version not matches the server major version - the request is rejected - to protect old clients from doing  mad things</li>
</ul>

<h2>
<a id="usecases" class="anchor" href="#usecases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usecases</h2>

<h3>
<a id="backup-a-dir" class="anchor" href="#backup-a-dir" aria-hidden="true"><span class="octicon octicon-link"></span></a>Backup a Dir</h3>

<p>dir to back up: /home/www/configs/
server identification: myServer
encryption password: fooSecret
ricServer: ric1.server.de
ricWriterToke: barSecret</p>

<h4>
<a id="store-the-passwords" class="anchor" href="#store-the-passwords" aria-hidden="true"><span class="octicon octicon-link"></span></a>store the passwords</h4>

<pre><code>echo "fooSecret" &gt; /home/www/ricPassFile.txt
chmod 600 /home/www/ricPassFile.txt
echo "barSecret" &gt; /home/www/ricWriterFile.txt
chmod 600 /home/www/ricPassFile.txt
</code></pre>

<h4>
<a id="cronjobs-with-sic-monitoring" class="anchor" href="#cronjobs-with-sic-monitoring" aria-hidden="true"><span class="octicon octicon-link"></span></a>cronjobs (with sic monitoring)</h4>

<pre><code>*/5 * * * * /usr/local/sbin/ric backup /home/www/configs/ myServer-configs.tar.bz2 --retention=last7 --passFile=/home/www/ricPassFile.txt --prefix=myServer- --authFile=/home/www/ricWriterFile.txt --server=ric1.server.de 2&gt;&amp;1 &gt;/dev/null | /usr/local/sbin/sic /myServer/ric-backup --STDINasCRITICAL
*/2 * * * * /usr/local/sbin/ric check myServer-configs.tar.bz2 --prefix=myServer- --authFile=/home/www/ricWriterFile.txt --server=ric1.server.de --minTimestamp=-300  2&gt;&amp;1 &gt;/dev/null | /usr/local/sbin/sic /myServer/ric-backup/check --STDINasCRITICAL
</code></pre>

<h2>
<a id="server-manifest" class="anchor" href="#server-manifest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Server Manifest</h2>

<ul>
<li>no daemon type, only react on request, no long running requests</li>
<li>all response is json, except download and errors</li>
<li>the base is a normal filesystem, files in a hashed directory, with original filenames extended by it's sha1</li>
<li>no other persistent storage for attributes no database</li>
<li>it's seen as critical, if a file has no replicas</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>The MIT License (MIT)</p>
      </section>
    </div>

    
  </body>
</html>
